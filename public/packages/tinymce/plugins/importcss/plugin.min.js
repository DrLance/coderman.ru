/**
 * Copyright (c) Tiny Technologies, Inc. All rights reserved.
 * Licensed under the LGPL or a commercial license.
 * For LGPL see License.txt in the project root for license information.
 * For commercial licenses see https://www.tiny.cloud/
 *
 * Version: 5.3.0 (TBD)
 */
!function(){"use strict";function a(t){return t.getParam("importcss_selector_converter")}function l(t,n){return function(t){for(var n=[],e=0,r=t.length;e<r;++e){if(!i(t[e]))throw new Error("Arr.flatten item "+e+" was not an array, input: "+t);o.apply(n,t[e])}return n}(function(t,n){for(var e=t.length,r=new Array(e),i=0;i<e;i++){var o=t[i];r[i]=n(o,i)}return r}(t,n))}function e(n){return"string"==typeof n?function(t){return-1!==t.indexOf(n)}:n instanceof RegExp?function(t){return n.test(t)}:n}function f(o,t,c){var u=[],e={};function s(t,n){var e,r=t.href;if((r=function(t){var n=g.cacheSuffix;return"string"==typeof t&&(t=t.replace("?"+n,"").replace("&"+n,"")),t}(r))&&c(r,n)&&!function(t,n){var e=t.settings,r=!1!==e.skin&&(e.skin||"oxide");if(r){var i=e.skin_url?t.documentBaseURI.toAbsolute(e.skin_url):y.baseURL+"/skins/ui/"+r,o=y.baseURL+"/skins/content/";return n===i+"/content"+(t.inline?".inline":"")+".min.css"||-1!==n.indexOf(o)}return!1}(o,r)){h.each(t.imports,function(t){s(t,!0)});try{e=t.cssRules||t.rules}catch(i){}h.each(e,function(t){t.styleSheet?s(t.styleSheet,!0):t.selectorText&&h.each(t.selectorText.split(","),function(t){u.push(h.trim(t))})})}}h.each(o.contentCSS,function(t){e[t]=!0}),c=c||function(t,n){return n||e[t]};try{h.each(t.styleSheets,function(t){s(t)})}catch(n){}return u}function m(t,n){var e,r=/^(?:([a-z0-9\-_]+))?(\.[a-z0-9_\-\.]+)$/i.exec(n);if(r){var i=r[1],o=r[2].substr(1).split(".").join(" "),c=h.makeMap("a,img");return r[1]?(e={title:n},t.schema.getTextBlockElements()[i]?e.block=i:t.schema.getBlockElements()[i]||c[i.toLowerCase()]?e.selector=i:e.inline=i):r[2]&&(e={inline:"span",title:n.substr(1),classes:o}),!1!==function(t){return t.getParam("importcss_merge_classes")}(t)?e.classes=o:e.attributes={"class":o},e}}function p(t,n){return null===n||!1!==function(t){return t.getParam("importcss_exclusive")}(t)}function n(s){s.on("init",function(t){function r(t,n){if(function(t,n,e,r){return!(p(t,e)?n in r:n in e.selectors)}(s,t,n,o)){!function(t,n,e,r){p(t,e)?r[n]=!0:e.selectors[n]=!0}(s,t,n,o);var e=function(t,n,e,r){return(r&&r.selector_converter?r.selector_converter:a(t)?a(t):function(){return m(t,e)}).call(n,e,r)}(s,s.plugins.importcss,t,n);if(e){var r=e.name||v.DOM.uniqueId();return s.formatter.register(r,e),h.extend({},{title:e.title,format:r})}}return null}var i=function(){var n=[],e=[],r={};return{addItemToGroup:function(t,n){r[t]?r[t].push(n):(e.push(t),r[t]=[n])},addItem:function(t){n.push(t)},toFormats:function(){return l(e,function(t){var n=r[t];return 0===n.length?[]:[{title:t,items:n}]}).concat(n)}}}(),o={},c=e(function(t){return t.getParam("importcss_selector_filter")}(s)),u=function(t){return h.map(t,function(t){return h.extend({},t,{original:t,selectors:{},filter:e(t.filter),item:{text:t.title,menu:[]}})})}(function(t){return t.getParam("importcss_groups")}(s));h.each(f(s,s.getDoc(),e(function(t){return t.getParam("importcss_file_filter")}(s))),function(e){if(-1===e.indexOf(".mce-")&&(!c||c(e))){var t=function(t,n){return h.grep(t,function(t){return!t.filter||t.filter(n)})}(u,e);if(0<t.length)h.each(t,function(t){var n=r(e,t);n&&i.addItemToGroup(t.title,n)});else{var n=r(e,null);n&&i.addItem(n)}}});var n=i.toFormats();s.fire("addStyleModifications",{items:n,replace:!function(t){return t.getParam("importcss_append")}(s)})})}var r,t=tinymce.util.Tools.resolve("tinymce.PluginManager"),v=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),y=tinymce.util.Tools.resolve("tinymce.EditorManager"),g=tinymce.util.Tools.resolve("tinymce.Env"),h=tinymce.util.Tools.resolve("tinymce.util.Tools"),i=(r="array",function(t){return function(t){var n=typeof t;return null===t?"null":"object"==n&&(Array.prototype.isPrototypeOf(t)||t.constructor&&"Array"===t.constructor.name)?"array":"object"==n&&(String.prototype.isPrototypeOf(t)||t.constructor&&"String"===t.constructor.name)?"string":n}(t)===r}),o=Array.prototype.push;!function c(){t.add("importcss",function(t){return n(t),function(n){return{convertSelectorToFormat:function(t){return m(n,t)}}}(t)})}()}();