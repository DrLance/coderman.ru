/**
 * Copyright (c) Tiny Technologies, Inc. All rights reserved.
 * Licensed under the LGPL or a commercial license.
 * For LGPL see License.txt in the project root for license information.
 * For commercial licenses see https://www.tiny.cloud/
 *
 * Version: 5.3.0 (TBD)
 */
!function(l){"use strict";function n(){}function i(n){return function(){return n}}function t(){return a}var e=tinymce.util.Tools.resolve("tinymce.PluginManager"),c=i(!1),u=i(!0),a={fold:function(n,t){return n()},is:c,isSome:c,isNone:u,getOr:s,getOrThunk:r,getOrDie:function(n){throw new Error(n||"error: getOrDie called on none.")},getOrNull:i(null),getOrUndefined:i(undefined),or:s,orThunk:r,map:t,each:n,bind:t,exists:c,forall:u,filter:t,equals:o,equals_:o,toArray:function(){return[]},toString:i("none()")};function o(n){return n.isNone()}function r(n){return n()}function s(n){return n}function f(n,t){return-1!==n.indexOf(t)}function m(n,t){return f(n.title.toLowerCase(),t)||function(n,t){for(var e=0,o=n.length;e<o;e++){if(t(n[e],e))return!0}return!1}(n.keywords,function(n){return f(n.toLowerCase(),t)})}function g(n,t,e){for(var o=[],r=t.toLowerCase(),i=e.fold(function(){return c},function(t){return function(n){return t<=n}}),u=0;u<n.length&&(0!==t.length&&!m(n[u],r)||(o.push({value:n[u]["char"],text:n[u].title,icon:n[u]["char"]}),!i(o.length)));u++);return o}function d(n,t){for(var e=T(n),o=0,r=e.length;o<r;o++){var i=e[o];t(n[i],i)}}function y(n,t){return function(n,t){return _.call(n,t)}(n,t)?n[t]:t}function h(n){return function(n,e){return D(n,function(n,t){return{k:t,v:e(n,t)}})}(function(n){return n.getParam("emoticons_append",{},"object")}(n),function(n){return k({keywords:[],category:"user"},n)})}function v(e,r,n){var o=C(O.none()),u=C(O.none());e.on("init",function(){P.load(n,r).then(function(n){var t=h(e);!function(n){var r={},i=[];d(n,function(n,t){var e={title:t,keywords:n.keywords,"char":n["char"],category:y(N,n.category)},o=r[e.category]!==undefined?r[e.category]:[];r[e.category]=o.concat([e]),i.push(e)}),o.set(O.some(r)),u.set(O.some(i))}(A(n,t))},function(n){l.console.log("Failed to load emoticons: "+n),o.set(O.some({})),u.set(O.some([]))})});var i=function(){return u.get().getOr([])},c=function(){return o.get().isSome()&&u.get().isSome()};return{listCategories:function(){return[S].concat(T(o.get().getOr({})))},hasLoaded:c,waitForLoad:function(){return c()?L.resolve(!0):new L(function(n,t){var e=15,o=x.setInterval(function(){c()?(x.clearInterval(o),n(!0)):--e<0&&(l.console.log("Could not load emojis from url: "+r),x.clearInterval(o),t(!1))},100)})},listAll:i,listCategory:function(t){return t===S?i():o.get().bind(function(n){return O.from(n[t])}).getOr([])}}}function p(e,i){function n(){return{title:"Emoticons",size:"normal",body:{type:"tabpanel",tabs:function(n,t){for(var e=n.length,o=new Array(e),r=0;r<e;r++){var i=n[r];o[r]=t(i,r)}return o}(i.listCategories(),function(n){return{title:n,name:n,items:[r,c]}})},initialData:t,onTabChange:function(n,t){u.set(t.newTabName),o.throttle(n)},onChange:o.throttle,onAction:function(n,t){"results"===t.name&&(function(n,t){n.insertContent(t)}(e,t.value),n.close())},buttons:[{type:"cancel",text:"Close",primary:!0}]}}var t={pattern:"",results:g(i.listAll(),"",O.some(300))},u=C(S),o=function(e,o){var r=null;return{cancel:function(){null!==r&&(l.clearTimeout(r),r=null)},throttle:function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];null!==r&&l.clearTimeout(r),r=l.setTimeout(function(){e.apply(null,n),r=null},o)}}}(function(n){!function(n){var t=n.getData(),e=u.get(),o=i.listCategory(e),r=g(o,t[E],e===S?O.some(300):O.none());n.setData({results:r})}(n)},200),r={label:"Search",type:"input",name:E},c={type:"collection",name:"results"},a=e.windowManager.open(n());a.focus(E),i.hasLoaded()||(a.block("Loading emoticons..."),i.waitForLoad().then(function(){a.redial(n()),o.throttle(a),a.focus(E),a.unblock()})["catch"](function(n){a.redial({title:"Emoticons",body:{type:"panel",items:[{type:"alertbanner",level:"error",icon:"warning",text:"<p>Could not load emoticons</p>"}]},buttons:[{type:"cancel",text:"Close",primary:!0}],initialData:{pattern:"",results:[]}}),a.focus(E),a.unblock()}))}var b,w=function(e){function n(){return r}function t(n){return n(e)}var o=i(e),r={fold:function(n,t){return t(e)},is:function(n){return e===n},isSome:u,isNone:c,getOr:o,getOrThunk:o,getOrDie:o,getOrNull:o,getOrUndefined:o,or:n,orThunk:n,map:function(n){return w(n(e))},each:function(n){n(e)},bind:t,exists:t,forall:t,filter:function(n){return n(e)?r:a},toArray:function(){return[e]},toString:function(){return"some("+e+")"},equals:function(n){return n.is(e)},equals_:function(n,t){return n.fold(c,function(n){return t(e,n)})}};return r},O={some:w,none:t,from:function(n){return null===n||n===undefined?a:w(n)}},C=function(n){function t(){return e}var e=n;return{get:t,set:function(n){e=n},clone:function(){return C(t())}}},k=function(){return(k=Object.assign||function(n){for(var t,e=1,o=arguments.length;e<o;e++)for(var r in t=arguments[e])Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r]);return n}).apply(this,arguments)},j=Object.prototype.hasOwnProperty,A=(b=function(n,t){return t},function(){for(var n=new Array(arguments.length),t=0;t<n.length;t++)n[t]=arguments[t];if(0===n.length)throw new Error("Can't merge zero objects");for(var e={},o=0;o<n.length;o++){var r=n[o];for(var i in r)j.call(r,i)&&(e[i]=b(e[i],r[i]))}return e}),T=Object.keys,_=Object.hasOwnProperty,D=function(n,o){var r={};return d(n,function(n,t){var e=o(n,t);r[e.k]=e.v}),r},P=tinymce.util.Tools.resolve("tinymce.Resource"),x=tinymce.util.Tools.resolve("tinymce.util.Delay"),L=tinymce.util.Tools.resolve("tinymce.util.Promise"),S="All",N={symbols:"Symbols",people:"People",animals_and_nature:"Animals and Nature",food_and_drink:"Food and Drink",activity:"Activity",travel_and_places:"Travel and Places",objects:"Objects",flags:"Flags",user:"User Defined"},E="pattern";!function F(){e.add("emoticons",function(n,t){var e=function(n,t){return n.getParam("emoticons_database_url",t+"/js/emojis"+n.suffix+".js")}(n,t),o=function(n){return n.getParam("emoticons_database_id","tinymce.plugins.emoticons","string")}(n),r=v(n,e,o);!function(n,t){function e(){return p(n,t)}n.ui.registry.addButton("emoticons",{tooltip:"Emoticons",icon:"emoji",onAction:e}),n.ui.registry.addMenuItem("emoticons",{text:"Emoticons...",icon:"emoji",onAction:e})}(n,r),function(o,r){o.ui.registry.addAutocompleter("emoticons",{ch:":",columns:"auto",minChars:2,fetch:function(t,e){return r.waitForLoad().then(function(){var n=r.listAll();return g(n,t,O.some(e))})},onAction:function(n,t,e){o.selection.setRng(t),o.insertContent(e),n.hide()}})}(n,r)})}()}(window);