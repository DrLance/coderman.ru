/**
 * Copyright (c) Tiny Technologies, Inc. All rights reserved.
 * Licensed under the LGPL or a commercial license.
 * For LGPL see License.txt in the project root for license information.
 * For commercial licenses see https://www.tiny.cloud/
 *
 * Version: 5.3.0 (TBD)
 */
!function(r){"use strict";function n(t){return function(n){return function(n){var t=typeof n;return null===n?"null":"object"==t&&(Array.prototype.isPrototypeOf(n)||n.constructor&&"Array"===n.constructor.name)?"array":"object"==t&&(String.prototype.isPrototypeOf(n)||n.constructor&&"String"===n.constructor.name)?"string":t}(n)===t}}function t(t){return function(n){return typeof n===t}}function o(n){var t=n.getParam("link_assume_external_targets",!1);return p(t)&&t?1:!d(t)||"http"!==t&&"https"!==t?0:t}function c(n){return n.getParam("default_link_target")}function i(n){return n.getParam("target_list",!0)}function u(n){return n.getParam("rel_list",[],"array")}function a(n){return n.getParam("allow_unsafe_link_target",!1,"boolean")}function l(n){var t=r.document.createElement("a");t.target="_blank",t.href=n,t.rel="noreferrer noopener";var e=r.document.createEvent("MouseEvents");e.initMouseEvent("click",!0,!0,r.window,0,0,0,0,0,!1,!1,!1,!1,0,null),function(n,t){r.document.body.appendChild(n),n.dispatchEvent(t),r.document.body.removeChild(n)}(t,e)}function f(){}function s(n){return function(){return n}}function e(){return b}var m=tinymce.util.Tools.resolve("tinymce.PluginManager"),g=tinymce.util.Tools.resolve("tinymce.util.VK"),d=n("string"),h=n("array"),p=t("boolean"),v=t("function"),y=function(){return(y=Object.assign||function(n){for(var t,e=1,r=arguments.length;e<r;e++)for(var o in t=arguments[e])Object.prototype.hasOwnProperty.call(t,o)&&(n[o]=t[o]);return n}).apply(this,arguments)},k=s(!1),x=s(!0),b={fold:function(n,t){return n()},is:k,isSome:k,isNone:x,getOr:A,getOrThunk:w,getOrDie:function(n){throw new Error(n||"error: getOrDie called on none.")},getOrNull:s(null),getOrUndefined:s(undefined),or:A,orThunk:w,map:e,each:f,bind:e,exists:k,forall:x,filter:e,equals:O,equals_:O,toArray:function(){return[]},toString:s("none()")};function O(n){return n.isNone()}function w(n){return n()}function A(n){return n}function C(n,t){return-1<function(n,t){return tn.call(n,t)}(n,t)}function N(n){for(var t=[],e=0,r=n.length;e<r;++e){if(!h(n[e]))throw new Error("Arr.flatten item "+e+" was not an array, input: "+n);en.apply(t,n[e])}return t}function _(n,t){return N(function(n,t){for(var e=n.length,r=new Array(e),o=0;o<e;o++){var i=n[o];r[o]=t(i,o)}return r}(n,t))}function P(n,t){for(var e=0;e<n.length;e++){var r=t(n[e],e);if(r.isSome())return r}return nn.none()}function S(n){return/^\w+:/i.test(n)}function T(n){var t=n.getAttribute("data-mce-href");return t||n.getAttribute("href")}function D(n,t){var e,r,o=["noopener"],i=n?n.split(/\s+/):[],u=function(n){return n.filter(function(n){return-1===rn.inArray(o,n)})},a=t?0<(e=u(e=i)).length?e.concat(o):o:u(i);return 0<a.length?(r=a,rn.trim(r.sort().join(" "))):""}function L(n,t){return t=t||n.selection.getNode(),on(t)?n.dom.select("a[href]",t)[0]:n.dom.getParent(t,"a[href]")}function M(n,t){return function(n){return n.replace(/\uFEFF/g,"")}(t?t.innerText||t.textContent:n.getContent({format:"text"}))}function E(n){return n&&"A"===n.nodeName&&!!T(n)}function R(n){return 0<rn.grep(n,E).length}function U(n){return!(/</.test(n)&&(!/^<a [^>]+>[^<]+<\/a>$/.test(n)||-1===n.indexOf("href=")))}function q(n,t){var e=y({},t);if(!(0<u(n).length)&&!1===a(n)){var r=D(e.rel,"_blank"===e.target);e.rel=r||null}return nn.from(e.target).isNone()&&!1===i(n)&&(e.target=c(n)),e.href=function(n,t){return"http"!==t&&"https"!==t||S(n)?n:t+"://"+n}(e.href,o(n)),e}function K(n,t,e){var r=n.selection.getNode(),o=L(n,r),i=q(n,function(n){return function(n,t,e){return function(n,t){for(var e=0,r=n.length;e<r;e++){t(n[e],e)}}(n,function(n){e=t(e,n)}),e}(["title","rel","class","target"],function(t,e){return n[e].each(function(n){t[e]=0<n.length?n:null}),t},{href:n.href})}(e));n.undoManager.transact(function(){e.href===t.href&&t.attach(),o?(n.focus(),function(n,t,e,r){e.each(function(n){t.hasOwnProperty("innerText")?t.innerText=n:t.textContent=n}),n.dom.setAttribs(t,r),n.selection.select(t)}(n,o,e.text,i)):function(t,n,e,r){on(n)?an(t,n,r):e.fold(function(){t.execCommand("mceInsertLink",!1,r)},function(n){t.insertContent(t.dom.createHTML("a",r,t.dom.encode(n)))})}(n,r,e.text,i)})}function z(e){e.undoManager.transact(function(){var n=e.selection.getNode();if(on(n))un(e,n);else{var t=e.dom.getParent(n,"a[href]",e.getBody());t&&e.dom.remove(t,!0)}e.focus()})}function I(n){return d(n.value)?n.value:""}function B(t){return void 0===t&&(t=I),function(n){return nn.from(n).map(function(n){return function(n,r){var o=[];return rn.each(n,function(n){var t=d(n.text)?n.text:d(n.title)?n.title:"";if(n.menu!==undefined);else{var e=r(n);o.push({text:t,value:e})}}),o}(n,t)})}}function V(t,n,e,r){var o=r[n],i=0<t.length;return o!==undefined?function(t,n){return P(n,function(n){return nn.some(n).filter(function(n){return n.value===t})})}(o,e).map(function(n){return{url:{value:n.value,meta:{text:i?t:n.text,attach:f}},text:i?t:n.text}}):nn.none()}function j(n){var t=n.href;return 0<t.indexOf("@")&&-1===t.indexOf("//")&&-1===t.indexOf("mailto:")?nn.some({message:"The URL you entered seems to be an email address. Do you want to add the required mailto: prefix?",preprocess:function(n){return y(y({},n),{href:"mailto:"+t})}}):nn.none()}function F(n,t,e){var r=n.getAttrib(t,e);return null!==r&&0<r.length?nn.some(r):nn.none()}function W(t){(function(n){var t=L(n);return bn(n,t)})(t).then(function(n){return function(n,t,e){var r=n.anchor.text.map(function(){return{name:"text",type:"input",label:"Text to display"}}).toArray(),o=n.flags.titleEnabled?[{name:"title",type:"input",label:"Title"}]:[],i=function(n,t){return{url:{value:n.anchor.url.getOr(""),meta:{attach:function(){},text:n.anchor.url.fold(function(){return""},function(){return n.anchor.text.getOr("")}),original:{value:n.anchor.url.getOr("")}}},text:n.anchor.text.getOr(""),title:n.anchor.title.getOr(""),anchor:n.anchor.url.getOr(""),link:n.anchor.url.getOr(""),rel:n.anchor.rel.getOr(""),target:n.anchor.target.or(t).getOr(""),linkClass:n.anchor.linkClass.getOr("")}}(n,nn.from(c(e))),u=fn(i,n),a=n.catalogs;return{title:"Insert/Edit Link",size:"normal",body:{type:"panel",items:N([[{name:"url",type:"urlinput",filetype:"file",label:"URL"}],r,o,function(n){for(var t=[],e=function(n){t.push(n)},r=0;r<n.length;r++)n[r].each(e);return t}([a.anchor.map(cn.createUi("anchor","Anchors")),a.rels.map(cn.createUi("rel","Rel")),a.targets.map(cn.createUi("target","Open link in...")),a.link.map(cn.createUi("link","Link list")),a.classes.map(cn.createUi("linkClass","Class"))])])},buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],initialData:i,onChange:function(t,n){var e=n.name;u.onChange(t.getData,{name:e}).each(function(n){t.setData(n)})},onSubmit:t}}(n,function(i,u){return function(n){var e=n.getData();if(!e.url.value)return z(i),void n.close();function t(t){return nn.from(e[t]).filter(function(n){return!u.anchor[t].is(n)})}var r={href:e.url.value,text:t("text"),target:t("target"),rel:t("rel"),"class":t("linkClass"),title:t("title")},o={href:e.url.value,attach:e.url.meta!==undefined&&e.url.meta.attach?e.url.meta.attach:function(){}};gn(i,r).then(function(n){K(i,o,n)}),n.close()}}(t,n),t)}).then(function(n){t.windowManager.open(n)})}function H(n,t){return n.dom.getParent(t,"a[href]")}function $(n){return H(n,n.selection.getStart())}function G(n,t){if(t){var e=T(t);if(/^#/.test(e)){var r=n.$(e);r.length&&n.selection.scrollIntoView(r[0],!0)}else l(t.href)}}function J(n){return function(){W(n)}}function X(n){return function(){G(n,$(n))}}function Q(e){return function(t){function n(n){return t.setActive(!e.mode.isReadOnly()&&!!L(e,n.element))}return e.on("NodeChange",n),function(){return e.off("NodeChange",n)}}}function Y(r){return function(t){var n=r.dom.getParents(r.selection.getStart());t.setDisabled(!R(n));function e(n){return t.setDisabled(!R(n.parents))}return r.on("NodeChange",e),function(){return r.off("NodeChange",e)}}}var Z=function(e){function n(){return o}function t(n){return n(e)}var r=s(e),o={fold:function(n,t){return t(e)},is:function(n){return e===n},isSome:x,isNone:k,getOr:r,getOrThunk:r,getOrDie:r,getOrNull:r,getOrUndefined:r,or:n,orThunk:n,map:function(n){return Z(n(e))},each:function(n){n(e)},bind:t,exists:t,forall:t,filter:function(n){return n(e)?o:b},toArray:function(){return[e]},toString:function(){return"some("+e+")"},equals:function(n){return n.is(e)},equals_:function(n,t){return n.fold(k,function(n){return t(e,n)})}};return o},nn={some:Z,none:e,from:function(n){return null===n||n===undefined?b:Z(n)}},tn=Array.prototype.indexOf,en=Array.prototype.push,rn=tinymce.util.Tools.resolve("tinymce.util.Tools"),on=function(n){return n&&"FIGURE"===n.nodeName&&/\bimage\b/i.test(n.className)},un=function(n,t){var e=n.dom.select("img",t)[0];if(e){var r=n.dom.getParents(e,"a[href]",t)[0];r&&(r.parentNode.insertBefore(e,r),n.dom.remove(r))}},an=function(n,t,e){var r=n.dom.select("img",t)[0];if(r){var o=n.dom.create("a",e);r.parentNode.insertBefore(o,r),o.appendChild(r)}},cn={sanitize:function(n){return B(I)(n)},sanitizeWith:B,createUi:function(t,e){return function(n){return{name:t,type:"selectbox",label:e,items:n}}},getValue:I},ln=function(n){function t(){return e}var e=n;return{get:t,set:function(n){e=n},clone:function(){return ln(t())}}},fn=function(n,r){function e(n,t){var e=function(n,t){return"link"===t?n.catalogs.link:"anchor"===t?n.catalogs.anchor:nn.none()}(r,t.name).getOr([]);return V(o.get(),t.name,e,n)}var o=ln(n.text);return{onChange:function(n,t){return"url"===t.name?function(n){if(o.get().length<=0){var t=n.url.meta.text!==undefined?n.url.meta.text:n.url.value,e=n.url.meta.title!==undefined?n.url.meta.title:"";return nn.some({text:t,title:e})}return nn.none()}(n()):C(["anchor","link"],t.name)?e(n(),t):("text"===t.name&&o.set(n().text),nn.none())}}},sn=tinymce.util.Tools.resolve("tinymce.util.Delay"),mn=tinymce.util.Tools.resolve("tinymce.util.Promise"),gn=function(n,r){return P([j,function(e,r){return function(n){var t=n.href;return 1===e&&!S(t)||0===e&&/^\s*www[\.|\d\.]/i.test(t)?nn.some({message:"The URL you entered seems to be an external link. Do you want to add the required "+r+":// prefix?",preprocess:function(n){return y(y({},n),{href:r+"://"+t})}}):nn.none()}}(o(n),function(n){return n.getParam("link_default_protocol","http","string")}(n))],function(n){return n(r)}).fold(function(){return mn.resolve(r)},function(e){return new mn(function(t){!function(t,n,e){var r=t.selection.getRng();sn.setEditorTimeout(t,function(){t.windowManager.confirm(n,function(n){t.selection.setRng(r),e(n)})})}(n,e.message,function(n){t(n?e.preprocess(r):r)})})})},dn=function(n){var t=n.dom.select("a:not([href])"),e=_(t,function(n){var t=n.name||n.id;return t?[{text:t,value:"#"+t}]:[]});return 0<e.length?nn.some([{text:"None",value:""}].concat(e)):nn.none()},hn=function(n){var t=function(n){return n.getParam("link_class_list",[],"array")}(n);return 0<t.length?cn.sanitize(t):nn.none()},pn=tinymce.util.Tools.resolve("tinymce.util.XHR"),vn=function(t){function e(n){return t.convertURL(n.value||n.url,"href")}var n=function(n){return n.getParam("link_list")}(t);return new mn(function(t){d(n)?pn.send({url:n,success:function(n){return t(function(n){try{return nn.some(JSON.parse(n))}catch(t){return nn.none()}}(n))},error:function(n){return t(nn.none())}}):v(n)?n(function(n){return t(nn.some(n))}):t(nn.from(n))}).then(function(n){return n.bind(cn.sanitizeWith(e)).map(function(n){return 0<n.length?[{text:"None",value:""}].concat(n):n})})},yn=function(n,t){var e=u(n);if(0<e.length){var r=t.is("_blank");return(!1===a(n)?cn.sanitizeWith(function(n){return D(cn.getValue(n),r)}):cn.sanitize)(e)}return nn.none()},kn=[{text:"Current window",value:""},{text:"New window",value:"_blank"}],xn=function(n){var t=i(n);return h(t)?cn.sanitize(t).orThunk(function(){return nn.some(kn)}):!1===t?nn.none():nn.some(kn)},bn=function(e,r){return vn(e).then(function(n){var t=function(n,t){var e=n.dom,r=U(n.selection.getContent())?nn.some(M(n.selection,t)):nn.none(),o=t?nn.some(e.getAttrib(t,"href")):nn.none(),i=t?nn.from(e.getAttrib(t,"target")):nn.none(),u=F(e,t,"rel"),a=F(e,t,"class");return{url:o,text:r,title:F(e,t,"title"),target:i,rel:u,linkClass:a}}(e,r);return{anchor:t,catalogs:{targets:xn(e),rels:yn(e,t.target),classes:hn(e),anchor:dn(e),link:n},optNode:nn.from(r),flags:{titleEnabled:function(n){return n.getParam("link_title",!0,"boolean")}(e)}}})};!function On(){m.add("link",function(n){!function(n){n.ui.registry.addToggleButton("link",{icon:"link",tooltip:"Insert/edit link",onAction:J(n),onSetup:Q(n)}),n.ui.registry.addButton("openlink",{icon:"new-tab",tooltip:"Open link",onAction:X(n),onSetup:Y(n)}),n.ui.registry.addButton("unlink",{icon:"unlink",tooltip:"Remove link",onAction:function(){return z(n)},onSetup:Y(n)})}(n),function(n){n.ui.registry.addMenuItem("openlink",{text:"Open link",icon:"new-tab",onAction:X(n),onSetup:Y(n)}),n.ui.registry.addMenuItem("link",{icon:"link",text:"Link...",shortcut:"Meta+K",onAction:J(n)}),n.ui.registry.addMenuItem("unlink",{icon:"unlink",text:"Remove link",onAction:function(){return z(n)},onSetup:Y(n)})}(n),function(t){t.ui.registry.addContextMenu("link",{update:function(n){return R(t.dom.getParents(n,"a"))?"link unlink openlink":"link"}})}(n),function(i){function n(n){var t=i.selection.getNode();return n.setDisabled(!L(i,t)),function(){}}i.ui.registry.addContextForm("quicklink",{launch:{type:"contextformtogglebutton",icon:"link",tooltip:"Link",onSetup:Q(i)},label:"Link",predicate:function(n){return!!L(i,n)&&function(n){return n.getParam("link_context_toolbar",!1,"boolean")}(i)},initValue:function(){var n=L(i);return n?T(n):""},commands:[{type:"contextformtogglebutton",icon:"link",tooltip:"Link",primary:!0,onSetup:function(n){var t=i.selection.getNode();return n.setActive(!!L(i,t)),Q(i)(n)},onAction:function(n){var t=L(i),e=n.getValue();if(t)i.dom.setAttrib(t,"href",e),function(n){n.selection.collapse(!1)}(i),n.hide();else{var r={href:e,attach:function(){}},o=U(i.selection.getContent())?nn.some(M(i.selection,t)).filter(function(n){return 0<n.length}).or(nn.from(e)):nn.none();K(i,r,{href:e,text:o,title:nn.none(),rel:nn.none(),target:nn.none(),"class":nn.none()}),n.hide()}}},{type:"contextformbutton",icon:"unlink",tooltip:"Remove link",onSetup:n,onAction:function(n){z(i),n.hide()}},{type:"contextformbutton",icon:"new-tab",tooltip:"Open link",onSetup:n,onAction:function(n){X(i)(),n.hide()}}]})}(n),function(e){e.on("click",function(n){var t=H(e,n.target);t&&g.metaKeyPressed(n)&&(n.preventDefault(),G(e,t))}),e.on("keydown",function(n){var t=$(e);t&&13===n.keyCode&&function(n){return!0===n.altKey&&!1===n.shiftKey&&!1===n.ctrlKey&&!1===n.metaKey}(n)&&(n.preventDefault(),G(e,t))})}(n),function(n){n.addCommand("mceLink",function(){!function(n){return n.getParam("link_quicklink",!1,"boolean")}(n)?J(n)():n.fire("contexttoolbar-show",{toolbarKey:"quicklink"})})}(n),function(n){n.addShortcut("Meta+K","",function(){n.execCommand("mceLink")})}(n)})}()}(window);