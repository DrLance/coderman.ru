/**
 * Copyright (c) Tiny Technologies, Inc. All rights reserved.
 * Licensed under the LGPL or a commercial license.
 * For LGPL see License.txt in the project root for license information.
 * For commercial licenses see https://www.tiny.cloud/
 *
 * Version: 5.3.0 (TBD)
 */
!function(v){"use strict";function e(){}function n(){return c}var r=function(e){function n(){return t}var t=e;return{get:n,set:function(e){t=e},clone:function(){return r(n())}}},t=tinymce.util.Tools.resolve("tinymce.PluginManager"),i=tinymce.util.Tools.resolve("tinymce.util.Tools"),l=function(e){return function(){return e}},u=l(!1),a=l(!0),c={fold:function(e,n){return e()},is:u,isSome:u,isNone:a,getOr:f,getOrThunk:s,getOrDie:function(e){throw new Error(e||"error: getOrDie called on none.")},getOrNull:l(null),getOrUndefined:l(undefined),or:f,orThunk:s,map:n,each:e,bind:n,exists:u,forall:a,filter:n,equals:o,equals_:o,toArray:function(){return[]},toString:l("none()")};function o(e){return e.isNone()}function s(e){return e()}function f(e){return e}var d=function(t){function e(){return o}function n(e){return e(t)}var r=l(t),o={fold:function(e,n){return n(t)},is:function(e){return t===e},isSome:a,isNone:u,getOr:r,getOrThunk:r,getOrDie:r,getOrNull:r,getOrUndefined:r,or:e,orThunk:e,map:function(e){return d(e(t))},each:function(e){e(t)},bind:n,exists:n,forall:n,filter:function(e){return e(t)?o:c},toArray:function(){return[t]},toString:function(){return"some("+t+")"},equals:function(e){return e.is(t)},equals_:function(e,n){return e.fold(u,function(e){return n(t,e)})}};return o},p={some:d,none:n,from:function(e){return null===e||e===undefined?c:d(e)}};function m(e,n){return w(v.document.createElement("canvas"),e,n)}function h(e){var n=m(e.width,e.height);return g(n).drawImage(e,0,0),n}function g(e){return e.getContext("2d")}function w(e,n,t){return e.width=n,e.height=t,e}var y,b,E=window.Promise?window.Promise:(y=O.immediateFn||"function"==typeof window.setImmediate&&window.setImmediate||function(e){v.setTimeout(e,1)},b=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},O.prototype["catch"]=function(e){return this.then(null,e)},O.prototype.then=function(t,r){var o=this;return new O(function(e,n){x.call(o,new I(t,r,e,n))})},O.all=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var c=Array.prototype.slice.call(1===e.length&&b(e[0])?e[0]:e);return new O(function(o,i){if(0===c.length)return o([]);var u=c.length;function a(n,e){try{if(e&&("object"==typeof e||"function"==typeof e)){var t=e.then;if("function"==typeof t)return void t.call(e,function(e){a(n,e)},i)}c[n]=e,0==--u&&o(c)}catch(r){i(r)}}for(var e=0;e<c.length;e++)a(e,c[e])})},O.resolve=function(n){return n&&"object"==typeof n&&n.constructor===O?n:new O(function(e){e(n)})},O.reject=function(t){return new O(function(e,n){n(t)})},O.race=function(o){return new O(function(e,n){for(var t=0,r=o;t<r.length;t++)r[t].then(e,n)})},O);function O(e){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=null,this._value=null,this._deferreds=[],S(e,T(_,this),T(N,this))}function T(e,n){return function(){return e.apply(n,arguments)}}function x(r){var o=this;null!==this._state?y(function(){var e=o._state?r.onFulfilled:r.onRejected;if(null!==e){var n;try{n=e(o._value)}catch(t){return void r.reject(t)}r.resolve(n)}else(o._state?r.resolve:r.reject)(o._value)}):this._deferreds.push(r)}function _(e){try{if(e===this)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"==typeof e||"function"==typeof e)){var n=e.then;if("function"==typeof n)return void S(T(n,e),T(_,this),T(N,this))}this._state=!0,this._value=e,R.call(this)}catch(t){N.call(this,t)}}function N(e){this._state=!1,this._value=e,R.call(this)}function R(){for(var e=0,n=this._deferreds;e<n.length;e++){var t=n[e];x.call(this,t)}this._deferreds=[]}function I(e,n,t,r){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof n?n:null,this.resolve=t,this.reject=r}function S(e,n,t){var r=!1;try{e(function(e){r||(r=!0,n(e))},function(e){r||(r=!0,t(e))})}catch(o){if(r)return;r=!0,t(o)}}function A(e){var n=e.src;return 0===n.indexOf("data:")?U(n):function t(r){return new E(function(e,t){var n=new v.XMLHttpRequest;n.open("GET",r,!0),n.responseType="blob",n.onload=function(){200===this.status&&e(this.response)},n.onerror=function(){var e,n=this;t(0===this.status?((e=new Error("No access to download image")).code=18,e.name="SecurityError",e):new Error("Error "+n.status+" downloading image"))},n.send()})}(n)}function C(a){return new E(function(e,n){var t=v.URL.createObjectURL(a),r=new v.Image,o=function(){r.removeEventListener("load",i),r.removeEventListener("error",u)};function i(){o(),e(r)}function u(){o(),n("Unable to load data of type "+a.type+": "+t)}r.addEventListener("load",i),r.addEventListener("error",u),r.src=t,r.complete&&i()})}function U(t){return new E(function(e,n){(function g(e){var n=e.split(","),t=/data:([^;]+)/.exec(n[0]);if(!t)return p.none();for(var r=t[1],o=n[1],i=v.atob(o),u=i.length,a=Math.ceil(u/1024),c=new Array(a),s=0;s<a;++s){for(var f=1024*s,d=Math.min(1024+f,u),l=new Array(d-f),m=f,h=0;m<d;++h,++m)l[h]=i[m].charCodeAt(0);c[s]=new Uint8Array(l)}return p.some(new v.Blob(c,{type:r}))})(t).fold(function(){n("uri is not base64: "+t)},e)})}function D(e,r,o){return r=r||"image/png",v.HTMLCanvasElement.prototype.toBlob?new E(function(n,t){e.toBlob(function(e){e?n(e):t()},r,o)}):U(e.toDataURL(r,o))}function L(e){return C(e).then(function(e){!function t(e){v.URL.revokeObjectURL(e.src)}(e);var n=m(function r(e){return e.naturalWidth||e.width}(e),function o(e){return e.naturalHeight||e.height}(e));return g(n).drawImage(e,0,0),n})}function k(e,n,t){var r=n.type;function o(n,t){return e.then(function(e){return function r(e,n,t){return n=n||"image/png",e.toDataURL(n,t)}(e,n,t)})}return{getType:l(r),toBlob:function i(){return E.resolve(n)},toDataURL:function u(){return t},toBase64:function a(){return t.split(",")[1]},toAdjustedBlob:function c(n,t){return e.then(function(e){return D(e,n,t)})},toAdjustedDataURL:o,toAdjustedBase64:function s(e,n){return o(e,n).then(function(e){return e.split(",")[1]})},toCanvas:function f(){return e.then(h)}}}function j(n){return function e(t){return new E(function(e){var n=new v.FileReader;n.onloadend=function(){e(n.result)},n.readAsDataURL(t)})}(n).then(function(e){return k(L(n),n,e)})}function M(n,e){return D(n,e).then(function(e){return k(E.resolve(n),e,n.toDataURL())})}function P(n,t){return n.toCanvas().then(function(e){return function a(e,n,t){var r=m(e.width,e.height),o=g(r),i=0,u=0;90!==(t=t<0?360+t:t)&&270!==t||w(r,r.height,r.width);90!==t&&180!==t||(i=r.width);270!==t&&180!==t||(u=r.height);return o.translate(i,u),o.rotate(t*Math.PI/180),o.drawImage(e,0,0),M(r,n)}(e,n.getType(),t)})}function B(n,t){return n.toCanvas().then(function(e){return function i(e,n,t){var r=m(e.width,e.height),o=g(r);"v"===t?(o.scale(1,-1),o.drawImage(e,0,-r.height)):(o.scale(-1,1),o.drawImage(e,-r.width,0));return M(r,n)}(e,n.getType(),t)})}function F(e){return j(e)}var H=tinymce.util.Tools.resolve("tinymce.util.Delay"),q=tinymce.util.Tools.resolve("tinymce.util.Promise"),$=tinymce.util.Tools.resolve("tinymce.util.URI");function z(e){var n,t;function r(e){return/^[0-9\.]+px$/.test(e)}return n=e.style.width,t=e.style.height,n||t?r(n)&&r(t)?{w:parseInt(n,10),h:parseInt(t,10)}:null:(n=e.width,t=e.height,n&&t?{w:parseInt(n,10),h:parseInt(t,10)}:null)}function X(e){return{w:e.naturalWidth,h:e.naturalHeight}}function W(e,n){for(var t=0,r=e.length;t<r;t++){var o=e[t];if(n(o,t))return p.some(o)}return p.none()}function G(e){return null!==e&&e!==undefined}function V(n,r,o){return new q(function(e){var t;(t=new v.XMLHttpRequest).onreadystatechange=function(){4===t.readyState&&e({status:t.status,blob:this.response})},t.open("GET",n,!0),t.withCredentials=o,i.each(r,function(e,n){t.setRequestHeader(n,e)}),t.responseType="blob",t.send()})}function Y(e){var n=function(n){return"ImageProxy HTTP error: "+W(Z,function(e){return n===e.code}).fold(l("Unknown ImageProxy error"),function(e){return e.message})}(e);return q.reject(n)}function J(e){var n=function(e,n){var t;return t=n.reduce(function(e,n){return G(e)?e[n]:undefined},e),G(t)?t:null}(function(e){var n;try{n=JSON.parse(e)}catch(t){}return n}(e),["error","type"]);return"ImageProxy Service error: "+(n?function(n){return W(ee,function(e){return e.type===n}).fold(l("Unknown service error"),function(e){return e.message})}(n):"Invalid JSON in service error message")}function K(e,n){return function(n){return new q(function(t){var e=new v.FileReader;e.onload=function(e){var n=e.target;t(n.result)},e.readAsText(n)})}(n).then(function(e){var n=J(e);return q.reject(n)})}function Q(e,n){var t={"Content-Type":"application/json;charset=UTF-8","tiny-api-key":n};return V(function(e,n){var t=-1===e.indexOf("?")?"?":"&";return/[?&]apiKey=/.test(e)||!n?e:e+t+"apiKey="+encodeURIComponent(n)}(e,n),t,!1).then(function(e){return e.status<200||300<=e.status?function(e,n){return function(e){return 400===e||403===e||500===e}(e)?K(0,n):Y(e)}(e.status,e.blob):q.resolve(e.blob)})}var Z=[{code:404,message:"Could not find Image Proxy"},{code:403,message:"Rejected request"},{code:0,message:"Incorrect Image Proxy URL"}],ee=[{type:"key_missing",message:"The request did not include an api key."},{type:"key_not_found",message:"The provided api key could not be found."},{type:"domain_not_trusted",message:"The api key is not valid for the request origins."}];function ne(e,n,t){return n?Q(e,n):function r(e,n){return V(e,{},n).then(function(e){return e.status<200||300<=e.status?Y(e.status):q.resolve(e.blob)})}(e,t)}function te(e,n){var t=function(e,n){for(var t=0;t<e.length;t++){var r=e[t];if(r.test(n))return r}return undefined}(e,n);if(!t)return{major:0,minor:0};function r(e){return Number(n.replace(t,"$"+e))}return Te(r(1),r(2))}function re(e,n){var t=String(n).toLowerCase();return W(e,function(e){return e.search(t)})}function oe(e,n){return-1!==e.indexOf(n)}function ie(n){return function(e){return oe(e,n)}}function ue(e,n){return function(e,n){return W(e.dom().childNodes,function(e){return n($e.fromDom(e))}).map($e.fromDom)}(e,function(e){return function(e,n){var t=e.dom();if(t.nodeType!==Xe)return!1;var r=t;if(r.matches!==undefined)return r.matches(n);if(r.msMatchesSelector!==undefined)return r.msMatchesSelector(n);if(r.webkitMatchesSelector!==undefined)return r.webkitMatchesSelector(n);if(r.mozMatchesSelector!==undefined)return r.mozMatchesSelector(n);throw new Error("Browser lacks native selectors")}(e,n)})}function ae(e){return ue($e.fromDom(e),"img")}function ce(e,n){return e.dom.is(n,"figure")}function se(n,e){function t(e){return function(e){return n.dom.is(e,"img:not([data-mce-object],[data-mce-placeholder])")}(e)&&(Ge(n,e)||Ve(n,e)||n.settings.imagetools_proxy)}return ce(n,e)?ae(e).map(function(e){return t(e.dom())?p.some(e.dom()):p.none()}):t(e)?p.some(e):p.none()}function fe(e,n){e.notificationManager.open({text:n,type:"error"})}function de(e){var n=e.selection.getNode();return ce(e,n)?ae(n):p.some($e.fromDom(n))}function le(e,n){var t,r=n.src;return Ve(e,n)?ne(n.src,null,function(e,n){return-1!==i.inArray(function(e){return e.getParam("imagetools_credentials_hosts",[],"string[]")}(e),new $(n.src).host)}(e,n)):Ge(e,n)?function(e){return A(e)}(n):(r=function(e){return e.getParam("imagetools_proxy")}(e),r+=(-1===r.indexOf("?")?"?":"&")+"url="+encodeURIComponent(n.src),t=function(e){return e.getParam("api_key",e.getParam("imagetools_api_key","","string"),"string")}(e),ne(r,t,!1))}function me(e,n){return function(e){return p.from(e.getParam("imagetools_fetch_image",null,"function"))}(e).fold(function(){return le(e,n)},function(e){return e(n)})}function he(e,n){var t;return(t=e.editorUpload.blobCache.getByUri(n.src))?q.resolve(t.blob()):me(e,n)}function ge(e){H.clearTimeout(e.get())}function ve(i,u,a,c,s,f){return u.toBlob().then(function(e){var n,t,r,o;return r=i.editorUpload.blobCache,n=s.src,function(e){return e.getParam("images_reuse_filename",!1,"boolean")}(i)&&(t=(o=r.getByUri(n))?(n=o.uri(),o.name()):function(e,n){var t=n.match(/\/([^\/\?]+)?\.(?:jpeg|jpg|png|gif)(?:\?|$)/i);return t?e.dom.encode(t[1]):null}(i,n)),o=r.create({id:"imagetools"+We++,blob:e,base64:u.toBase64(),uri:n,name:t}),r.add(o),i.undoManager.transact(function(){i.$(s).on("load",function e(){i.$(s).off("load",e),i.nodeChanged(),a?i.editorUpload.uploadImagesAuto():(ge(c),function(e,n){var t=H.setEditorTimeout(e,function(){e.editorUpload.uploadImagesAuto()},function(e){return e.getParam("images_upload_timeout",3e4,"number")}(e));n.set(t)}(i,c))}),f&&i.$(s).attr({width:f.w,height:f.h}),i.$(s).attr({src:o.blobUri()}).removeAttr("data-mce-src")}),o})}function pe(t,r,e,o){return function(){return de(t).fold(function(){fe(t,"Could not find selected image")},function(n){return t._scanForImages().then(function(){return he(t,n.dom())}).then(F).then(e).then(function(e){return ve(t,e,!1,r,n.dom(),o)},function(e){fe(t,e)})})}}function we(n,t,r){return function(){var e=de(n).fold(function(){return null},function(e){var n=z(e.dom());return n?{w:n.h,h:n.w}:null});return pe(n,t,function(e){return function(e,n){return P(e,n)}(e,r)},e)()}}function ye(e,n,t){return function(){return pe(e,n,function(e){return function(e,n){return B(e,n)}(e,t)})()}}function be(n,t,r,i,u){return new q(function(e){(function(e){return C(e)})(u).then(function(e){var n=X(e);return i.w===n.w&&i.h===n.h||z(r)&&function o(e,n){var t,r;n&&(t=e.style.width,r=e.style.height,(t||r)&&(e.style.width=n.w+"px",e.style.height=n.h+"px",e.removeAttribute("data-mce-style")),t=e.width,r=e.height,(t||r)&&(e.setAttribute("width",n.w),e.setAttribute("height",n.h)))}(r,n),v.URL.revokeObjectURL(e.src),u}).then(F).then(function(e){return ve(n,e,!0,t,r)},function(){})})}function Ee(i,u){return function(){var r=de(i),o=r.map(function(e){return X(e.dom())});de(i).each(function(n){se(i,n.dom()).each(function(e){he(i,n.dom()).then(function(e){var n=function(e){return{blob:e,url:v.URL.createObjectURL(e)}}(e);i.windowManager.open(function(e){return{title:"Edit Image",size:"large",body:{type:"panel",items:[{type:"imagetools",name:"imagetools",label:"Edit Image",currentState:e}]},buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0,disabled:!0}],onSubmit:function(e){var t=e.getData().imagetools.blob;r.each(function(n){o.each(function(e){be(i,u,n.dom(),e,t)})}),e.close()},onCancel:function(){},onAction:function(e,n){switch(n.name){case"save-state":n.value?e.enable("save"):e.disable("save");break;case"disable":e.disable("save"),e.disable("cancel");break;case"enable":e.enable("cancel")}}}}(n))})})})}}var Oe=function(){return Te(0,0)},Te=function(e,n){return{major:e,minor:n}},xe={nu:Te,detect:function(e,n){var t=String(n).toLowerCase();return 0===e.length?Oe():te(e,t)},unknown:Oe},_e="Firefox",Ne=function(e){function n(e){return function(){return t===e}}var t=e.current,r=e.version;return{current:t,version:r,isEdge:n("Edge"),isChrome:n("Chrome"),isIE:n("IE"),isOpera:n("Opera"),isFirefox:n(_e),isSafari:n("Safari")}},Re={unknown:function(){return Ne({current:undefined,version:xe.unknown()})},nu:Ne,edge:l("Edge"),chrome:l("Chrome"),ie:l("IE"),opera:l("Opera"),firefox:l(_e),safari:l("Safari")},Ie="Windows",Se="Android",Ae="Solaris",Ce="FreeBSD",Ue="ChromeOS",De=function(e){function n(e){return function(){return t===e}}var t=e.current,r=e.version;return{current:t,version:r,isWindows:n(Ie),isiOS:n("iOS"),isAndroid:n(Se),isOSX:n("OSX"),isLinux:n("Linux"),isSolaris:n(Ae),isFreeBSD:n(Ce),isChromeOS:n(Ue)}},Le={unknown:function(){return De({current:undefined,version:xe.unknown()})},nu:De,windows:l(Ie),ios:l("iOS"),android:l(Se),linux:l("Linux"),osx:l("OSX"),solaris:l(Ae),freebsd:l(Ce),chromeos:l(Ue)},ke=function(e,t){return re(e,t).map(function(e){var n=xe.detect(e.versionRegexes,t);return{current:e.name,version:n}})},je=function(e,t){return re(e,t).map(function(e){var n=xe.detect(e.versionRegexes,t);return{current:e.name,version:n}})},Me=/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,Pe=[{name:"Edge",versionRegexes:[/.*?edge\/ ?([0-9]+)\.([0-9]+)$/],search:function(e){return oe(e,"edge/")&&oe(e,"chrome")&&oe(e,"safari")&&oe(e,"applewebkit")}},{name:"Chrome",versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/,Me],search:function(e){return oe(e,"chrome")&&!oe(e,"chromeframe")}},{name:"IE",versionRegexes:[/.*?msie\ ?([0-9]+)\.([0-9]+).*/,/.*?rv:([0-9]+)\.([0-9]+).*/],search:function(e){return oe(e,"msie")||oe(e,"trident")}},{name:"Opera",versionRegexes:[Me,/.*?opera\/([0-9]+)\.([0-9]+).*/],search:ie("opera")},{name:"Firefox",versionRegexes:[/.*?firefox\/\ ?([0-9]+)\.([0-9]+).*/],search:ie("firefox")},{name:"Safari",versionRegexes:[Me,/.*?cpu os ([0-9]+)_([0-9]+).*/],search:function(e){return(oe(e,"safari")||oe(e,"mobile/"))&&oe(e,"applewebkit")}}],Be=[{name:"Windows",search:ie("win"),versionRegexes:[/.*?windows\ nt\ ?([0-9]+)\.([0-9]+).*/]},{name:"iOS",search:function(e){return oe(e,"iphone")||oe(e,"ipad")},versionRegexes:[/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,/.*cpu os ([0-9]+)_([0-9]+).*/,/.*cpu iphone os ([0-9]+)_([0-9]+).*/]},{name:"Android",search:ie("android"),versionRegexes:[/.*?android\ ?([0-9]+)\.([0-9]+).*/]},{name:"OSX",search:ie("mac os x"),versionRegexes:[/.*?mac\ os\ x\ ?([0-9]+)_([0-9]+).*/]},{name:"Linux",search:ie("linux"),versionRegexes:[]},{name:"Solaris",search:ie("sunos"),versionRegexes:[]},{name:"FreeBSD",search:ie("freebsd"),versionRegexes:[]},{name:"ChromeOS",search:ie("cros"),versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/]}],Fe={browsers:l(Pe),oses:l(Be)},He=r(function(e,n){var t=Fe.browsers(),r=Fe.oses(),o=ke(t,e).fold(Re.unknown,Re.nu),i=je(r,e).fold(Le.unknown,Le.nu);return{browser:o,os:i,deviceType:function(e,n,t,r){var o=e.isiOS()&&!0===/ipad/i.test(t),i=e.isiOS()&&!o,u=e.isiOS()||e.isAndroid(),a=u||r("(pointer:coarse)"),c=o||!i&&u&&r("(min-device-width:768px)"),s=i||u&&!c,f=n.isSafari()&&e.isiOS()&&!1===/safari/i.test(t),d=!s&&!c&&!f;return{isiPad:l(o),isiPhone:l(i),isTablet:l(c),isPhone:l(s),isTouch:l(a),isAndroid:e.isAndroid,isiOS:e.isiOS,isWebView:l(f),isDesktop:l(d)}}(i,o,e,n)}}(v.navigator.userAgent,function(e){return v.window.matchMedia(e).matches})),qe=function(e){if(null===e||e===undefined)throw new Error("Node cannot be null or undefined");return{dom:l(e)}},$e={fromHtml:function(e,n){var t=(n||v.document).createElement("div");if(t.innerHTML=e,!t.hasChildNodes()||1<t.childNodes.length)throw v.console.error("HTML does not have a single root node",e),new Error("HTML must have a single root node");return qe(t.childNodes[0])},fromTag:function(e,n){var t=(n||v.document).createElement(e);return qe(t)},fromText:function(e,n){var t=(n||v.document).createTextNode(e);return qe(t)},fromDom:qe,fromPoint:function(e,n,t){var r=e.dom();return p.from(r.elementFromPoint(n,t)).map(qe)}},ze=(v.Node.ATTRIBUTE_NODE,v.Node.CDATA_SECTION_NODE,v.Node.COMMENT_NODE,v.Node.DOCUMENT_NODE,v.Node.DOCUMENT_TYPE_NODE,v.Node.DOCUMENT_FRAGMENT_NODE,v.Node.ELEMENT_NODE),Xe=(v.Node.TEXT_NODE,v.Node.PROCESSING_INSTRUCTION_NODE,v.Node.ENTITY_REFERENCE_NODE,v.Node.ENTITY_NODE,v.Node.NOTATION_NODE,ze),We=(He.get().browser.isIE(),"undefined"!=typeof v.window?v.window:Function("return this;")(),0),Ge=function(e,n){var t=n.src;return 0===t.indexOf("data:")||0===t.indexOf("blob:")||new $(t).host===e.documentBaseURI.host},Ve=function(e,n){return-1!==i.inArray(function(e){return e.getParam("imagetools_cors_hosts",[],"string[]")}(e),new $(n.src).host)};!function Ye(){t.add("imagetools",function(e){var n=r(0),t=r(null);!function(t,e){i.each({mceImageRotateLeft:we(t,e,-90),mceImageRotateRight:we(t,e,90),mceImageFlipVertical:ye(t,e,"v"),mceImageFlipHorizontal:ye(t,e,"h"),mceEditImage:Ee(t,e)},function(e,n){t.addCommand(n,e)})}(e,n),function(r){function n(e){return function(){return r.execCommand(e)}}r.ui.registry.addButton("rotateleft",{tooltip:"Rotate counterclockwise",icon:"rotate-left",onAction:n("mceImageRotateLeft")}),r.ui.registry.addButton("rotateright",{tooltip:"Rotate clockwise",icon:"rotate-right",onAction:n("mceImageRotateRight")}),r.ui.registry.addButton("flipv",{tooltip:"Flip vertically",icon:"flip-vertically",onAction:n("mceImageFlipVertical")}),r.ui.registry.addButton("fliph",{tooltip:"Flip horizontally",icon:"flip-horizontally",onAction:n("mceImageFlipHorizontal")}),r.ui.registry.addButton("editimage",{tooltip:"Edit image",icon:"edit-image",onAction:n("mceEditImage"),onSetup:function(t){function e(){de(r).each(function(e){var n=se(r,e.dom()).isNone();t.setDisabled(n)})}return r.on("NodeChange",e),function(){r.off("NodeChange",e)}}}),r.ui.registry.addButton("imageoptions",{tooltip:"Image options",icon:"image-options",onAction:n("mceImage")}),r.ui.registry.addContextMenu("imagetools",{update:function(e){return se(r,e).fold(function(){return[]},function(e){return[{text:"Edit image",icon:"edit-image",onAction:n("mceEditImage")}]})}})}(e),function(n){n.ui.registry.addContextToolbar("imagetools",{items:function(e){return e.getParam("imagetools_toolbar","rotateleft rotateright flipv fliph editimage imageoptions")}(n),predicate:function(e){return se(n,e).isSome()},position:"node",scope:"node"})}(e),function(t,r,o){t.on("NodeChange",function(e){var n=o.get();n&&n.src!==e.element.src&&(ge(r),t.editorUpload.uploadImagesAuto(),o.set(null)),se(t,e.element).each(o.set)})}(e,n,t)})}()}(window);